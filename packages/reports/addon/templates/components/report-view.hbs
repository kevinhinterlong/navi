{{!-- Copyright 2020, Yahoo Holdings Inc. Licensed under the terms of the MIT license. See accompanying LICENSE.md file for terms. --}}
<div class="report-view__visualization-main">
  {{#if hasNoData}}
    <div class="report-view__visualization-no-results">
      No results available.
    </div>
  {{else}}
    <div class="report-view__visualization-header">
      <VisualizationToggle
          @report={{@report}}
          @validVisualizations={{this.validVisualizations}}
          @onVisualizationTypeUpdate={{this.onVisualizationTypeUpdate}}
      />
      {{#if hasRequestRun}}
        {{#unless (or this.isEditingVisualization)}}
          <div class="clickable report-view__visualization-edit-btn" role="button" {{on "click" this.toggleEditVisualization}}>
            Edit {{this.visualizationTypeLabel}}
            <NaviIcon @icon="pencil"/>
          </div>
        {{/unless}}
      {{else}}
        <div class="report-view__info-text"><NaviIcon @icon="exclamation-circle"/> Run request to update {{this.visualizationTypeLabel}}</div>
      {{/if}}
    </div>
    <ReportVisualization
      class="report-view__visualization"
      @report={{@report}}
      @response={{@response}}
      @container={{this}}
      @annotationData={{this.annotationData}}
      @isEditing={{and this.isEditingVisualization @hasRequestRun}}
      @onUpdateReport={{pipe
        (route-action "onUpdateReport")
        (route-action "validate" @report)
        (route-action "runReport" @report)
      }}
    />
    <MissingIntervalsWarning
      @response={{this.response}}
      @onDetailsToggle={{fn this.resizeVisualization this.warningAnimationDuration}}
    />
  {{/if}}
</div>
{{#if (and this.isEditingVisualization @hasRequestRun)}}
  <div class="report-view__visualization-edit">
    <div class="report-view__visualization-edit-header">
      <div class="clickable report-view__visualization-edit-btn" role="button" {{on "click" this.toggleEditVisualization}}>
        Edit
        {{this.visualizationTypeLabel}}
        <NaviIcon @icon="times"/>
      </div>
    </div>
    <NaviVisualizationConfig::Wrapper
      @request={{@report.request}}
      @response={{@response.rows}}
      @classNames="report-view__navi-visualization-config"
      @visualization={{@report.visualization}}
      @onUpdateConfig={{route-action "onUpdateVisualizationConfig"}}
    />
  </div>
{{/if}}
